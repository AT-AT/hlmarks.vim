# NOTE

## テスト

* 概要はヘルプファイルを参照
* コンソールから実行されるVimがテスト対象であるかを確認
    * aliasの設定や環境変数PATHへの追加がテスト時に影響しない可能性に注意
    * 異なる場合は`VSPEC_VIM`環境変数の使用を検討（vim-vspecドキュメントを参照）
* 実行にはグローバルへインストールされた`rake`を使用
* vim-vspecのアップデートは、同プラグインの実行方法に変更が無い限り`vendor/vim-vspec`フォルダの入れ換えのみ
* `t`ディレクトリ直下にあるファイルのみテストとして実行（サブディレクトリ以下は非対象）
* `t`ディレクトリと同階層にある`autoload`ディレクトリはruntimepathに含まれているため、テストファイル内で`autoload`以下のファイルのロードは不要
* `plugin`ディレクトリ内のファイルはテストファイル内での読み込みが必要
* `VimEnter`イベントは起こらないため、それに紐付いた初期化ロジックはテスト内で明示的な実行が必要
* `Expect`式の中ではテストローカルな関数にはアクセス不能
* スクリプトローカルな変数や関数をテストする場合は、テスト対象ファイルへのパブリックなヘルパー関数定義と、`vspec#hint()`での指定が必要
* Ref()関数は辞書形式変数へのドットアクセスを処理不能
    ```vim
    " NG
    call Ref('s:foo.bar')
    " OK
    call (Ref('s:foo'))['bar']
    ```
* テスト中の出力には`vspec#debug()`を使用
    ```vim
    call vspec#debug(...)
    ```

## マーク

* 存在するマーク

    abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789^.'`"<>[](){}

* `0-9`は`.viminfo`ファイルによってセットされるため現時点ではテスト対象外
* `\``は`'`と同じマークとして処理されるため、一方が更新されるともう一方も更新される（以降`\``の記載は省略）
* `'`はジャンプにより自動更新され、削除不能
* `'`と`"`はバッファが開かれた時点から自動的に存在
* `"`はバッファが終了するまで変更されない
* `<`と`>`は範囲選択で自動セットされ、手動でセットしても範囲選択で上書きされる
* `>`を`<`と同じ行にセットするためには、`<`が存在して且つ一度`<`より後の行にセットすることが必要（但し1行を範囲選択すると同じ行に自動セットされる）
* 先に`<`を削除すると`>`が`<`へ変更され、そのため`>`単独では存在しない
* `[`、`]`、`^`、`.`は文字や行などの編集で自動更新される
* `^`と`.`は手動セット不能
* `(`、`)`、`{`、`}`は手動セット及び削除不能、マークリストにも非表示
* 手動セットと削除の可否から見た分類（記号類のみ）
** 手動セット可能 : `'"<>[]`
** 手動セット不可 : `^.(){}`
** 削除可能 : `^."<>[]`
** 削除不可 : `'(){}`

